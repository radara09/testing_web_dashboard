<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard AC RSUD</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .status-baik { color: #16a34a; font-weight: bold; }
    .status-warning { color: #ca8a04; font-weight: bold; }
    .status-buruk { color: #dc2626; font-weight: bold; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen p-6">
  <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- 游댳 KIRI ATAS -->
    <div class="bg-white rounded-3xl shadow p-6 text-center">
      <img id="qrImage" src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=AC-RS1-001"
           alt="QR Code" class="mx-auto mb-4 w-32 h-32">
      <p class="text-lg font-semibold" id="qrText">AC-RS1-001</p>
    </div>

    <!-- 游댳 KANAN ATAS -->
    <div class="bg-white rounded-3xl shadow p-6">
      <h2 class="text-xl font-bold mb-4">Informasi Detail AC</h2>
      <div class="space-y-1 text-gray-700">
        <p><b>Kode AC:</b> <span id="kodeAC">-</span></p>
        <p><b>Lokasi:</b> <span id="lokasiAC">-</span></p>
        <p><b>Merek:</b> <span id="merekAC">-</span></p>
        <p><b>Kondisi Terakhir:</b> <span id="kondisiAC" class="status-baik">-</span></p>
        <p><b>Service Terakhir:</b> <span id="serviceTerakhir">-</span></p>
        <p><b>Teknisi:</b> <span id="teknisiAC">-</span></p>
        <p><b>Jadwal Berikut:</b> <span id="jadwalBerikut">-</span></p>
      </div>
      <button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-2 rounded-xl">
        Lihat Foto Terakhir
      </button>
    </div>

    <!-- 游댳 KIRI BAWAH -->
    <div class="bg-white rounded-3xl shadow p-6">
      <h2 class="text-lg font-bold mb-3">Form Maintenance AC RSUD</h2>
      <label for="idInput" class="block mb-2">Cari ID_AC</label>
      <div class="flex gap-2 mb-4">
        <input id="idInput" type="text" placeholder="AC-RS1-001"
          class="border p-2 rounded w-full focus:ring focus:ring-blue-300">
        <button onclick="cariAC()"
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Cari</button>
      </div>
      <div class="space-y-1 text-gray-700">
        <p><b>Tekanan Freon:</b> <span id="tekananFreon">-</span></p>
        <p><b>Suhu Keluar:</b> <span id="suhuKeluar">-</span></p>
        <p><b>Ampere Kompresor:</b> <span id="ampereKompresor">-</span></p>
        <p><b>Kondisi Filter:</b> <span id="kondisiFilter">-</span></p>
      </div>
    </div>

    <!-- 游댳 KANAN BAWAH -->
    <div class="bg-white rounded-3xl shadow p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold">Dashboard Ringkas</h2>
        <button onclick="loadDashboard()" 
          class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm">游댃 Refresh Sekarang</button>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-blue-100 p-4 rounded-2xl text-center shadow-inner">
          <p>Total AC</p>
          <h2 id="totalAC" class="text-2xl font-bold">0</h2>
        </div>
        <div class="bg-red-100 p-4 rounded-2xl text-center shadow-inner">
          <p>AC Bermasalah</p>
          <h2 id="acBermasalah" class="text-2xl font-bold">0</h2>
        </div>
        <div class="bg-yellow-100 p-4 rounded-2xl text-center shadow-inner">
          <p>Belum Diservice >3 Bulan</p>
          <h2 id="belumDiservice" class="text-2xl font-bold">0</h2>
        </div>
        <div class="bg-green-100 p-4 rounded-2xl text-center shadow-inner">
          <p>Jumlah Teknisi</p>
          <h2 id="totalTeknisi" class="text-2xl font-bold">0</h2>
        </div>
      </div>
      <p class="text-xs text-gray-400 mt-2" id="lastUpdate">Terakhir update: -</p>
    </div>

  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbynH2oMX1UtowgZt33Q_VmaQt-tdC1xRbCCYK-4DCetSmS0Ff-uqJa-4BZWGGAsbDDq/exec'; // 游릭 Ganti dengan URL Web App kamu

    // 游릭 Fungsi utama untuk load ringkasan dashboard
    async function loadDashboard() {
      try {
        const res = await fetch(SCRIPT_URL);
        const result = await res.json();

        document.getElementById("totalAC").innerText = result.summary.totalAC;
        document.getElementById("acBermasalah").innerText = result.summary.bermasalah;
        document.getElementById("belumDiservice").innerText = result.summary.belumDiservice;
        document.getElementById("totalTeknisi").innerText = result.summary.totalTeknisi;

        const now = new Date();
        document.getElementById("lastUpdate").innerText = 
          "Terakhir update: " + now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
      } catch (err) {
        console.error(err);
        alert("丘멆잺 Gagal memuat data dashboard!");
      }
    }

    // 游릭 Fungsi pencarian AC berdasarkan ID
    async function cariAC() {
      const id = document.getElementById("idInput").value.trim();
      if (!id) return alert("Masukkan ID_AC terlebih dahulu!");

      try {
        const res = await fetch(`${SCRIPT_URL}?id=${id}`);
        const ac = await res.json();

        if (!ac || !ac.ID_AC) return alert("Data tidak ditemukan!");

        document.getElementById("kodeAC").innerText = ac.ID_AC || '-';
        document.getElementById("lokasiAC").innerText = ac.Lokasi || '-';
        document.getElementById("merekAC").innerText = ac.Merek || '-';

        const kondisi = (ac["Kondisi Terakhir"] || "-").toLowerCase();
        const elKondisi = document.getElementById("kondisiAC");
        elKondisi.innerText = ac["Kondisi Terakhir"] || '-';
        elKondisi.className = kondisi.includes('buruk') || kondisi.includes('rusak')
          ? 'status-buruk'
          : kondisi.includes('perlu') ? 'status-warning' : 'status-baik';

        document.getElementById("serviceTerakhir").innerText = ac["Service Terakhir"] || '-';
        document.getElementById("teknisiAC").innerText = ac.Teknisi || '-';
        document.getElementById("jadwalBerikut").innerText = ac["Jadwal Berikut"] || '-';

        document.getElementById("tekananFreon").innerText = ac["Tekanan Freon"] || '-';
        document.getElementById("suhuKeluar").innerText = ac["Suhu Keluar"] || '-';
        document.getElementById("ampereKompresor").innerText = ac["Ampere Kompresor"] || '-';
        document.getElementById("kondisiFilter").innerText = ac["Kondisi Filter"] || '-';

        document.getElementById("qrImage").src = 
          `https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${id}`;
        document.getElementById("qrText").innerText = id;
      } catch (err) {
        console.error(err);
        alert("丘멆잺 Gagal mencari data!");
      }
    }

    // 游릭 Jalankan otomatis tiap 5 menit
    window.onload = () => {
      loadDashboard();
      setInterval(loadDashboard, 300000); // 5 menit = 300.000 ms
    };
  </script>
</body>
</html>
